<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : ParseSndOrderRule
Description : Imports 2-rules from .ggx to verigraph
Stability   : experimental

AGG implements first order rules in the SPO approach, to model 2-rules
(second order rules in the DPO approach) a translation is needed.

AGG model: a rule is two graphs and a partial mapping between them.

@
  N
  &#9650;
  &#9474;
  L &#9472;&#9472;&#9472;&#9654; R
@

Verigraph second order model:

@
        nl       fl       fr
    Nl&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;La&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;\&lt;Lb\&gt;&#9472;&#9472;&#9472;&#9472;&#9472;&#9654;Lc
    &#9650;        &#9650;        &#9650;        &#9650;
 nal&#9474;      la&#9474;      lb&#9474;      lc&#9474;
    &#9474;        &#9474;        &#9474;        &#9474;
    ^   nk   ^   fk   ^   gk   ^
    Nk&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;Ka&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;\&lt;Kb\&gt;&#9472;&#9472;&#9472;&#9472;&#9472;&#9654;Kc
    v        v        v        v
 nar&#9474;      ra&#9474;      rb&#9474;      rc&#9474;
    &#9474;        &#9474;        &#9474;        &#9474;
    v   nr   &#9660;   fr   &#9660;   gr   &#9660;
    Nr&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;Ra&#9664;&#9472;&#9472;&#9472;&#9472;&#9472;\&lt;Rb\&gt;&#9472;&#9472;&#9472;&#9472;&#9472;&#9654;Rc
@

The second order rules in AGG must be represented as two first order rules with some aditional maps.

This maps bind two graph in different rules, to represent it we use the object names in AGG.

The object names map must bind the graphs La to Ra and Lc to Rc,
if there a NAC these maps will be needes: Nl to Nr, La to Nl and Ra to Nr.

Besides that, rule names in agg must follow this form: 2rule_(left|right|nacid)_(ruleName)

The translation from first order rules in the SPO to DPO is straightforward,
and additionally with object name maps, all second order rule can be instantiated.
-}</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">XML</span><span class="hs-operator">.</span><span class="hs-identifier">ParseSndOrderRule</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-49"></a><span>    </span><a href="XML.ParseSndOrderRule.html#parseSndOrderRules"><span class="hs-identifier hs-var">parseSndOrderRules</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="XML.ParseSndOrderRule.html#getLeftObjNameMapping"><span class="hs-identifier hs-var">getLeftObjNameMapping</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="XML.ParseSndOrderRule.html#getRightObjNameMapping"><span class="hs-identifier hs-var">getRightObjNameMapping</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorphism"><span class="hs-identifier hs-var">getObjectNacNameMorphism</span></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorphismNodes"><span class="hs-identifier hs-var">getObjectNacNameMorphismNodes</span></a><span>
</span><a name="line-54"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorphismEdges"><span class="hs-identifier hs-var">getObjectNacNameMorphismEdges</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjectNameMorphism"><span class="hs-identifier hs-var">getObjectNameMorphism</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><a href="Abstract.Morphism.html"><span class="hs-identifier">Abstract</span><span class="hs-operator">.</span><span class="hs-identifier">Morphism</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLower</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">find</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortOn</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">\\</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">join</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">split</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span>           </span><a href="Graph.Graph.html"><span class="hs-identifier">Graph</span><span class="hs-operator">.</span><span class="hs-identifier">Graph</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span>           </span><a href="Graph.GraphMorphism.html"><span class="hs-identifier">Graph</span><span class="hs-operator">.</span><span class="hs-identifier">GraphMorphism</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GM</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span>           </span><a href="TypedGraph.Morphism.html"><span class="hs-identifier">TypedGraph</span><span class="hs-operator">.</span><span class="hs-identifier">Morphism</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TGM</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span>           </span><a href="XML.ParsedTypes.html"><span class="hs-identifier">XML</span><span class="hs-operator">.</span><span class="hs-identifier">ParsedTypes</span></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | Gets the object name map between the left of two rules</span><span>
</span><a name="line-69"></a><span class="hs-identifier">getLeftObjNameMapping</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-70"></a><a name="getLeftObjNameMapping"><a href="XML.ParseSndOrderRule.html#getLeftObjNameMapping"><span class="hs-identifier">getLeftObjNameMapping</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124847"><a href="#local-6989586621679124847"><span class="hs-identifier">left</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124848"><a href="#local-6989586621679124848"><span class="hs-identifier">right</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjNameMapping"><span class="hs-identifier hs-var">getObjNameMapping</span></a><span> </span><a href="#local-6989586621679124847"><span class="hs-identifier hs-var">left</span></a><span> </span><a href="#local-6989586621679124848"><span class="hs-identifier hs-var">right</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | Gets the object name map between the right of two rules</span><span>
</span><a name="line-73"></a><span class="hs-identifier">getRightObjNameMapping</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-74"></a><a name="getRightObjNameMapping"><a href="XML.ParseSndOrderRule.html#getRightObjNameMapping"><span class="hs-identifier">getRightObjNameMapping</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124849"><a href="#local-6989586621679124849"><span class="hs-identifier">left</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124850"><a href="#local-6989586621679124850"><span class="hs-identifier">right</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjNameMapping"><span class="hs-identifier hs-var">getObjNameMapping</span></a><span> </span><a href="#local-6989586621679124849"><span class="hs-identifier hs-var">left</span></a><span> </span><a href="#local-6989586621679124850"><span class="hs-identifier hs-var">right</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- | Gets the object name map between two ParsedTypedGraph</span><span>
</span><a name="line-77"></a><span class="hs-identifier">getObjNameMapping</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="XML.ParsedTypes.html#ParsedTypedGraph"><span class="hs-identifier hs-type">ParsedTypedGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="XML.ParsedTypes.html#ParsedTypedGraph"><span class="hs-identifier hs-type">ParsedTypedGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-78"></a><a name="getObjNameMapping"><a href="XML.ParseSndOrderRule.html#getObjNameMapping"><span class="hs-identifier">getObjNameMapping</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124851"><a href="#local-6989586621679124851"><span class="hs-identifier">nodesL</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124852"><a href="#local-6989586621679124852"><span class="hs-identifier">edgesL</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124853"><a href="#local-6989586621679124853"><span class="hs-identifier">nodesR</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124854"><a href="#local-6989586621679124854"><span class="hs-identifier">edgesR</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124864"><span class="hs-identifier hs-var">mapNodes</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679124865"><span class="hs-identifier hs-var">mapEdges</span></a><span>
</span><a name="line-79"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-80"></a><span>    </span><a name="local-6989586621679124855"><a href="#local-6989586621679124855"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679124866"><a href="#local-6989586621679124866"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679124867"><a href="#local-6989586621679124867"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124866"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><a href="#local-6989586621679124867"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>    </span><a name="local-6989586621679124856"><a href="#local-6989586621679124856"><span class="hs-identifier">fNodes</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679124868"><a href="#local-6989586621679124868"><span class="hs-identifier">id</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124869"><a href="#local-6989586621679124869"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124855"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679124868"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621679124869"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-84"></a><span>    </span><a name="local-6989586621679124857"><a href="#local-6989586621679124857"><span class="hs-identifier">fEdges</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679124870"><a href="#local-6989586621679124870"><span class="hs-identifier">id</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124871"><a href="#local-6989586621679124871"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124855"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679124870"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621679124871"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>    </span><a name="local-6989586621679124858"><a href="#local-6989586621679124858"><span class="hs-identifier">nodesLMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-6989586621679124856"><span class="hs-identifier hs-var">fNodes</span></a><span> </span><a href="#local-6989586621679124851"><span class="hs-identifier hs-var">nodesL</span></a><span>
</span><a name="line-87"></a><span>    </span><a name="local-6989586621679124859"><a href="#local-6989586621679124859"><span class="hs-identifier">nodesRMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-6989586621679124856"><span class="hs-identifier hs-var">fNodes</span></a><span> </span><a href="#local-6989586621679124853"><span class="hs-identifier hs-var">nodesR</span></a><span>
</span><a name="line-88"></a><span>    </span><a name="local-6989586621679124860"><a href="#local-6989586621679124860"><span class="hs-identifier">edgesLMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-6989586621679124857"><span class="hs-identifier hs-var">fEdges</span></a><span> </span><a href="#local-6989586621679124852"><span class="hs-identifier hs-var">edgesL</span></a><span>
</span><a name="line-89"></a><span>    </span><a name="local-6989586621679124861"><a href="#local-6989586621679124861"><span class="hs-identifier">edgesRMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-6989586621679124857"><span class="hs-identifier hs-var">fEdges</span></a><span> </span><a href="#local-6989586621679124854"><span class="hs-identifier hs-var">edgesR</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>    </span><a name="local-6989586621679124862"><a href="#local-6989586621679124862"><span class="hs-identifier">getMap</span></a></a><span> </span><a name="local-6989586621679124872"><a href="#local-6989586621679124872"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span>
</span><a name="line-92"></a><span>                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679124873"><a href="#local-6989586621679124873"><span class="hs-identifier">id</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124874"><a href="#local-6989586621679124874"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-93"></a><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124875"><a href="#local-6989586621679124875"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124874"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679124875"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124872"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-94"></a><span>                     </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679124876"><a href="#local-6989586621679124876"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124876"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679124873"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>                     </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>    </span><a name="local-6989586621679124863"><a href="#local-6989586621679124863"><span class="hs-identifier">nonMono</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span>
</span><a name="line-98"></a><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679124877"><a href="#local-6989586621679124877"><span class="hs-identifier">id</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124878"><a href="#local-6989586621679124878"><span class="hs-identifier">objName</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-99"></a><span>                  </span><span class="hs-identifier hs-var">map</span><span>
</span><a name="line-100"></a><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679124879"><a href="#local-6989586621679124879"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124877"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><a href="#local-6989586621679124879"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">split</span><span> </span><span class="hs-string">&quot;|&quot;</span><span> </span><a href="#local-6989586621679124878"><span class="hs-identifier hs-var">objName</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>                </span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>    </span><a name="local-6989586621679124864"><a href="#local-6989586621679124864"><span class="hs-identifier">mapNodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124862"><span class="hs-identifier hs-var">getMap</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124863"><span class="hs-identifier hs-var">nonMono</span></a><span> </span><a href="#local-6989586621679124859"><span class="hs-identifier hs-var">nodesRMap</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124858"><span class="hs-identifier hs-var">nodesLMap</span></a><span>
</span><a name="line-105"></a><span>    </span><a name="local-6989586621679124865"><a href="#local-6989586621679124865"><span class="hs-identifier">mapEdges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124862"><span class="hs-identifier hs-var">getMap</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124863"><span class="hs-identifier hs-var">nonMono</span></a><span> </span><a href="#local-6989586621679124861"><span class="hs-identifier hs-var">edgesRMap</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124860"><span class="hs-identifier hs-var">edgesLMap</span></a><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | Receives all parsed 2-rules in the agg format (first order rule with object name maps)</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- and converts to second order rules on verigraph</span><span>
</span><a name="line-109"></a><span class="hs-identifier">parseSndOrderRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#RuleWithNacs"><span class="hs-identifier hs-type">RuleWithNacs</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">,</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-110"></a><a name="parseSndOrderRules"><a href="XML.ParseSndOrderRule.html#parseSndOrderRules"><span class="hs-identifier">parseSndOrderRules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="XML.ParseSndOrderRule.html#groupRules"><span class="hs-identifier hs-var">groupRules</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="XML.ParseSndOrderRule.html#getSndOrderRuleSide"><span class="hs-identifier hs-var">getSndOrderRuleSide</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- | Parse SndOrderRule names in the form: 2rule_left_ruleName or 2rule_nacName_ruleName</span><span>
</span><a name="line-113"></a><span class="hs-identifier">getSndOrderRuleSide</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="XML.ParsedTypes.html#RuleWithNacs"><span class="hs-identifier hs-type">RuleWithNacs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span>
</span><a name="line-114"></a><a name="getSndOrderRuleSide"><a href="XML.ParseSndOrderRule.html#getSndOrderRuleSide"><span class="hs-identifier">getSndOrderRuleSide</span></a></a><span> </span><a name="local-6989586621679124880"><a href="#local-6989586621679124880"><span class="hs-identifier">rule</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679124881"><a href="#local-6989586621679124881"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124883"><span class="hs-identifier hs-var">side</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679124884"><span class="hs-identifier hs-var">ruleName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679124880"><span class="hs-identifier hs-var">rule</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-116"></a><span>    </span><a name="local-6989586621679124882"><a href="#local-6989586621679124882"><span class="hs-identifier">splitted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">split</span><span> </span><span class="hs-string">&quot;_&quot;</span><span> </span><a href="#local-6989586621679124881"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-117"></a><span>    </span><a name="local-6989586621679124883"><a href="#local-6989586621679124883"><span class="hs-identifier">side</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679124882"><span class="hs-identifier hs-var">splitted</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-118"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Error parsing 2rule name&quot;</span><span>
</span><a name="line-119"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679124882"><span class="hs-identifier hs-var">splitted</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-6989586621679124884"><a href="#local-6989586621679124884"><span class="hs-identifier">ruleName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-string">&quot;_&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679124882"><span class="hs-identifier hs-var">splitted</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- put together rules in the form (left,right,[nacs])</span><span>
</span><a name="line-123"></a><span class="hs-identifier">groupRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">,</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#SndOrderRuleSide"><span class="hs-identifier hs-type">SndOrderRuleSide</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-124"></a><a name="groupRules"><a href="XML.ParseSndOrderRule.html#groupRules"><span class="hs-identifier">groupRules</span></a></a><span> </span><a name="local-6989586621679124885"><a href="#local-6989586621679124885"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-125"></a><span>  </span><span class="hs-identifier hs-var">map</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679124901"><a href="#local-6989586621679124901"><span class="hs-identifier">list</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-127"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679124902"><a href="#local-6989586621679124902"><span class="hs-identifier">left</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124890"><span class="hs-identifier hs-var">getLeft</span></a><span> </span><a href="#local-6989586621679124901"><span class="hs-identifier hs-var">list</span></a><span>
</span><a name="line-128"></a><span>          </span><a name="local-6989586621679124903"><a href="#local-6989586621679124903"><span class="hs-identifier">right</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124891"><span class="hs-identifier hs-var">getRight</span></a><span> </span><a href="#local-6989586621679124901"><span class="hs-identifier hs-var">list</span></a><span>
</span><a name="line-129"></a><span>          </span><a name="local-6989586621679124904"><a href="#local-6989586621679124904"><span class="hs-identifier">remainList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124901"><span class="hs-identifier hs-var">list</span></a><span> </span><span class="hs-operator hs-var">\\</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679124902"><span class="hs-identifier hs-var">left</span></a><span class="hs-special">,</span><a href="#local-6989586621679124903"><span class="hs-identifier hs-var">right</span></a><span class="hs-special">]</span><span>
</span><a name="line-130"></a><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124902"><span class="hs-identifier hs-var">left</span></a><span class="hs-special">,</span><a href="#local-6989586621679124903"><span class="hs-identifier hs-var">right</span></a><span class="hs-special">,</span><a href="#local-6989586621679124904"><span class="hs-identifier hs-var">remainList</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>     </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124889"><span class="hs-identifier hs-var">grouped</span></a><span>
</span><a name="line-132"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>    </span><a name="local-6989586621679124886"><a href="#local-6989586621679124886"><span class="hs-identifier">side</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679124893"><a href="#local-6989586621679124893"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124893"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-134"></a><span>    </span><a name="local-6989586621679124887"><a href="#local-6989586621679124887"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124894"><a href="#local-6989586621679124894"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124894"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-135"></a><span>    </span><a name="local-6989586621679124888"><a href="#local-6989586621679124888"><span class="hs-identifier">sorted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sortOn</span><span> </span><a href="#local-6989586621679124887"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679124885"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-136"></a><span>    </span><a name="local-6989586621679124889"><a href="#local-6989586621679124889"><span class="hs-identifier">grouped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679124895"><a href="#local-6989586621679124895"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679124896"><a href="#local-6989586621679124896"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124887"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679124895"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679124887"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679124896"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124888"><span class="hs-identifier hs-var">sorted</span></a><span>
</span><a name="line-137"></a><span>    </span><a name="local-6989586621679124890"><a href="#local-6989586621679124890"><span class="hs-identifier">getLeft</span></a></a><span> </span><a name="local-6989586621679124897"><a href="#local-6989586621679124897"><span class="hs-identifier">list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Second order rule without left&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124892"><span class="hs-identifier hs-var">findSide</span></a><span> </span><span class="hs-string">&quot;left&quot;</span><span> </span><a href="#local-6989586621679124897"><span class="hs-identifier hs-var">list</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>    </span><a name="local-6989586621679124891"><a href="#local-6989586621679124891"><span class="hs-identifier">getRight</span></a></a><span> </span><a name="local-6989586621679124898"><a href="#local-6989586621679124898"><span class="hs-identifier">list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Second order rule without right&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124892"><span class="hs-identifier hs-var">findSide</span></a><span> </span><span class="hs-string">&quot;right&quot;</span><span> </span><a href="#local-6989586621679124898"><span class="hs-identifier hs-var">list</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>    </span><a name="local-6989586621679124892"><a href="#local-6989586621679124892"><span class="hs-identifier">findSide</span></a></a><span> </span><a name="local-6989586621679124899"><a href="#local-6989586621679124899"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679124900"><a href="#local-6989586621679124900"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124886"><span class="hs-identifier hs-var">side</span></a><span> </span><a href="#local-6989586621679124900"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679124899"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- TODO: replace applyNodeUnsafe for getNodeType?</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- | Given a morphism from some graph in the rule left to nac extracts the mapping</span><span>
</span><a name="line-143"></a><span class="hs-identifier">getObjectNacNameMorph</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graph.GraphMorphism.html#GraphMorphism"><span class="hs-identifier hs-type">GraphMorphism</span></a><span> </span><a href="#local-6989586621679124845"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679124846"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><a name="getObjectNacNameMorph"><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorph"><span class="hs-identifier">getObjectNacNameMorph</span></a></a><span> </span><a name="local-6989586621679124905"><a href="#local-6989586621679124905"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124907"><span class="hs-identifier hs-var">nodesMap</span></a><span> </span><a href="#local-6989586621679124905"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679124908"><span class="hs-identifier hs-var">edgesMap</span></a><span> </span><a href="#local-6989586621679124905"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-146"></a><span>    </span><a name="local-6989586621679124906"><a href="#local-6989586621679124906"><span class="hs-identifier">adjustNonMono</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="XML.ParseSndOrderRule.html#parseNonMonoObjNames"><span class="hs-identifier hs-var">parseNonMonoObjNames</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679124910"><span class="hs-identifier hs-var">group</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679124911"><span class="hs-identifier hs-var">sort</span></a><span>
</span><a name="line-147"></a><span>    </span><a name="local-6989586621679124907"><a href="#local-6989586621679124907"><span class="hs-identifier">nodesMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124906"><span class="hs-identifier hs-var">adjustNonMono</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679124909"><span class="hs-identifier hs-var">getMap</span></a><span> </span><a href="Graph.GraphMorphism.html#applyNodeUnsafe"><span class="hs-identifier hs-var">GM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">applyNodeUnsafe</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Graph.Graph.html#nodeIds"><span class="hs-identifier hs-var">nodeIds</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Abstract.Morphism.html#domain"><span class="hs-identifier hs-var">domain</span></a><span>
</span><a name="line-148"></a><span>    </span><a name="local-6989586621679124908"><a href="#local-6989586621679124908"><span class="hs-identifier">edgesMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124906"><span class="hs-identifier hs-var">adjustNonMono</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679124909"><span class="hs-identifier hs-var">getMap</span></a><span> </span><a href="Graph.GraphMorphism.html#applyEdgeUnsafe"><span class="hs-identifier hs-var">GM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">applyEdgeUnsafe</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Graph.Graph.html#edgeIds"><span class="hs-identifier hs-var">edgeIds</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Abstract.Morphism.html#domain"><span class="hs-identifier hs-var">domain</span></a><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>    </span><a name="local-6989586621679124909"><a href="#local-6989586621679124909"><span class="hs-identifier">getMap</span></a></a><span> </span><a name="local-6989586621679124912"><a href="#local-6989586621679124912"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679124913"><a href="#local-6989586621679124913"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124912"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679124905"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679124913"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679124913"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>    </span><a name="local-6989586621679124910"><a href="#local-6989586621679124910"><span class="hs-identifier">group</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679124914"><a href="#local-6989586621679124914"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679124915"><a href="#local-6989586621679124915"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124914"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679124915"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679124911"><a href="#local-6989586621679124911"><span class="hs-identifier">sort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679124916"><a href="#local-6989586621679124916"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679124917"><a href="#local-6989586621679124917"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679124916"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679124917"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | Given a morphism from some graph in the rule left to nac extracts the mapping</span><span>
</span><a name="line-155"></a><span class="hs-identifier">getObjectNacNameMorphism</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graph.GraphMorphism.html#GraphMorphism"><span class="hs-identifier hs-type">GraphMorphism</span></a><span> </span><a href="#local-6989586621679124843"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679124844"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-156"></a><a name="getObjectNacNameMorphism"><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorphism"><span class="hs-identifier">getObjectNacNameMorphism</span></a></a><span> </span><a name="local-6989586621679124918"><a href="#local-6989586621679124918"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124919"><span class="hs-identifier hs-var">nods</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679124920"><span class="hs-identifier hs-var">edgs</span></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679124919"><a href="#local-6989586621679124919"><span class="hs-identifier">nods</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124920"><a href="#local-6989586621679124920"><span class="hs-identifier">edgs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorph"><span class="hs-identifier hs-var">getObjectNacNameMorph</span></a><span> </span><a href="#local-6989586621679124918"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-- | Given a morphism from some graph in the rule left to nac extracts the nodes mapping</span><span>
</span><a name="line-161"></a><span class="hs-identifier">getObjectNacNameMorphismNodes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graph.GraphMorphism.html#GraphMorphism"><span class="hs-identifier hs-type">GraphMorphism</span></a><span> </span><a href="#local-6989586621679124841"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679124842"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-162"></a><a name="getObjectNacNameMorphismNodes"><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorphismNodes"><span class="hs-identifier">getObjectNacNameMorphismNodes</span></a></a><span> </span><a name="local-6989586621679124921"><a href="#local-6989586621679124921"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorph"><span class="hs-identifier hs-var">getObjectNacNameMorph</span></a><span> </span><a href="#local-6989586621679124921"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Given a morphism from some graph in the rule left to nac extracts the edges mapping</span><span>
</span><a name="line-165"></a><span class="hs-identifier">getObjectNacNameMorphismEdges</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graph.GraphMorphism.html#GraphMorphism"><span class="hs-identifier hs-type">GraphMorphism</span></a><span> </span><a href="#local-6989586621679124839"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679124840"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-166"></a><a name="getObjectNacNameMorphismEdges"><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorphismEdges"><span class="hs-identifier">getObjectNacNameMorphismEdges</span></a></a><span> </span><a name="local-6989586621679124922"><a href="#local-6989586621679124922"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="XML.ParseSndOrderRule.html#getObjectNacNameMorph"><span class="hs-identifier hs-var">getObjectNacNameMorph</span></a><span> </span><a href="#local-6989586621679124922"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- | Glues the non mono maps</span><span>
</span><a name="line-169"></a><span class="hs-identifier">parseNonMonoObjNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-170"></a><a name="parseNonMonoObjNames"><a href="XML.ParseSndOrderRule.html#parseNonMonoObjNames"><span class="hs-identifier">parseNonMonoObjNames</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-171"></a><span class="hs-identifier">parseNonMonoObjNames</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679124923"><a href="#local-6989586621679124923"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679124924"><a href="#local-6989586621679124924"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124925"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679124926"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><a href="#local-6989586621679124928"><span class="hs-identifier hs-var">newObjName</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="XML.ParseSndOrderRule.html#parseNonMonoObjNames"><span class="hs-identifier hs-var">parseNonMonoObjNames</span></a><span> </span><a href="#local-6989586621679124924"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-172"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679124925"><a href="#local-6989586621679124925"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679124926"><a href="#local-6989586621679124926"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679124923"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679124927"><a href="#local-6989586621679124927"><span class="hs-identifier">allObjNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679124929"><a href="#local-6989586621679124929"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124929"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124923"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679124928"><a href="#local-6989586621679124928"><span class="hs-identifier">newObjName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-string">&quot;|&quot;</span><span> </span><a href="#local-6989586621679124927"><span class="hs-identifier hs-var">allObjNames</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- | Given two morphisms with the same domain, maps the codomain of both according to the interface (domain graph)</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- Used to translate DPO in verigraph to SPO in ggx</span><span>
</span><a name="line-179"></a><span class="hs-identifier">getObjectNameMorphism</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TypedGraph.Morphism.Core.html#TypedGraphMorphism"><span class="hs-identifier hs-type">TypedGraphMorphism</span></a><span> </span><a href="#local-6989586621679124837"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679124838"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TypedGraph.Morphism.Core.html#TypedGraphMorphism"><span class="hs-identifier hs-type">TypedGraphMorphism</span></a><span> </span><a href="#local-6989586621679124837"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679124838"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="XML.ParsedTypes.html#Mapping"><span class="hs-identifier hs-type">Mapping</span></a><span class="hs-special">]</span><span>
</span><a name="line-180"></a><a name="getObjectNameMorphism"><a href="XML.ParseSndOrderRule.html#getObjectNameMorphism"><span class="hs-identifier">getObjectNameMorphism</span></a></a><span> </span><a name="local-6989586621679124930"><a href="#local-6989586621679124930"><span class="hs-identifier">left</span></a></a><span> </span><a name="local-6989586621679124931"><a href="#local-6989586621679124931"><span class="hs-identifier">right</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124932"><span class="hs-identifier hs-var">nodesMap</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679124933"><span class="hs-identifier hs-var">edgesMap</span></a><span>
</span><a name="line-181"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621679124932"><a href="#local-6989586621679124932"><span class="hs-identifier">nodesMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124934"><span class="hs-identifier hs-var">getMap</span></a><span> </span><a href="TypedGraph.Morphism.Core.html#applyNodeUnsafe"><span class="hs-identifier hs-var">TGM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">applyNodeUnsafe</span></a><span> </span><span class="hs-special">(</span><a href="TypedGraph.Morphism.Core.html#nodeIdsFromDomain"><span class="hs-identifier hs-var">nodeIdsFromDomain</span></a><span> </span><a href="#local-6989586621679124930"><span class="hs-identifier hs-var">left</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>    </span><a name="local-6989586621679124933"><a href="#local-6989586621679124933"><span class="hs-identifier">edgesMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124934"><span class="hs-identifier hs-var">getMap</span></a><span> </span><a href="TypedGraph.Morphism.Core.html#applyEdgeUnsafe"><span class="hs-identifier hs-var">TGM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">applyEdgeUnsafe</span></a><span> </span><span class="hs-special">(</span><a href="TypedGraph.Morphism.Core.html#edgeIdsFromDomain"><span class="hs-identifier hs-var">edgeIdsFromDomain</span></a><span> </span><a href="#local-6989586621679124930"><span class="hs-identifier hs-var">left</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>    </span><a name="local-6989586621679124934"><a href="#local-6989586621679124934"><span class="hs-identifier">getMap</span></a></a><span> </span><a name="local-6989586621679124935"><a href="#local-6989586621679124935"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679124936"><a href="#local-6989586621679124936"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124935"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679124931"><span class="hs-identifier hs-var">right</span></a><span> </span><a href="#local-6989586621679124936"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124935"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679124930"><span class="hs-identifier hs-var">left</span></a><span> </span><a href="#local-6989586621679124936"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a></pre></body></html>